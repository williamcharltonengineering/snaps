name: nomadik
version: 1.4.3
base: core22
summary: Hashicorp Nomad packaged as Snap (arm64)
description: |
  A simple and flexible scheduler and orchestrator to deploy and manage containers and non-containerized applications across on-prem and clouds at scale.
type: app
grade: devel
architectures:
  - build-on: amd64
    build-for: amd64
  - build-on: amd64
    build-for: arm64

confinement: strict

apps:
  nomad:
    command: nomad
    plugs:
      - network
      - home

parts:
  nomad:
    plugin: nil
    override-build: |
      set -x
      curl \
        --retry 3 \
        --fail \
        -SL \
        -o nomad_$SNAPCRAFT_PROJECT_VERSION_linux_$SNAPCRAFT_TARGET_ARCH.zip \
        https://releases.hashicorp.com/nomad/$SNAPCRAFT_PROJECT_VERSION/nomad_$SNAPCRAFT_PROJECT_VERSION_linux_$SNAPCRAFT_TARGET_ARCH.zip
      # source-checksum: sha256/21b3afc78bca4789ac271a855e2c4a993876d0d3f84499692d0d9dc5c8abf9ca
      unzip -o nomad_$SNAPCRAFT_PROJECT_VERSION_linux_$SNAPCRAFT_TARGET_ARCH.zip -d ../install

build-packages:
  - curl
  - unzip
